#!/bin/sh -e
# Attempt to write the slurm script following /pfcalcul/tools/examples/gpu/cuda/pytorch example

echo "Running T-LESS test to reproduce Y. Labb√© results on CosyPose"

EXEC="cosypose"
GPU_REQUIRED=true

. /pfcalcul/tools/sbatchHelpers3.sh

jobMessage=$(
######################### SBATCH launcher
#########################     #SBATCH --option        # <= this is an enabled paramater
#########################     ##SBATCH --option       # <= this is a disabled parameter
sbatch ${sbatchopt} << eof
#!/bin/bash
#SBATCH --job-name=test_tless
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=1
#SBATCH --partition=gpu
#SBATCH --gres=gpu:${gpu}
#SBATCH --mail-type=ALL
#SBATCH --output=stdout.txt
#SBATCH --error=stderr.txt

. /pfcalcul/tools/sbatchHelpers3.sh

set -x
tmp=/tmp/slurm-\${SLURM_JOB_ID}-\$\$
mkdir \${tmp}
time apptainer exec --nv --bind /pfcalcul --bind \${tmp}:/tmp tless.sif bash run-in-container.bash

eof
)

showSubmitted
